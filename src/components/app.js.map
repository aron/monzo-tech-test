{"version":3,"sources":["../../../src/components/app.jsx"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["import {Component, h} from '../../vendor/preact.js';\nimport {gettext} from '../utils.js';\nimport {verifyToken} from '../client.js';\nimport {logoutAction, loadAppsAction, updateAppAction, performLoginAction} from '../actions.js';\nimport {initialAppState} from '../store.js';\n\nimport AppDirectory from './app_directory.js';\nimport AppInfo from './app_info.js';\nimport LoginForm from './login_form.js';\n\nexport default class AppContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = initialAppState();\n    \n    // TODO: Use babel plugin to support bound and static properties.\n    this.handleLogin = this.handleLogin.bind(this);\n    this.handleLogout = this.handleLogout.bind(this);\n    this.handleAppChange = this.handleAppChange.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.state.authToken) {\n      this.setupLoggedIn();\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.authToken && !prevState.authToken) {\n      this.setupLoggedIn();\n    } else if (!this.state.authToken) {\n      clearTimeout(this.pingTimer);\n    }\n  }\n\n  queueAuthPing() {\n    if (!this.state.authToken) {\n      return;\n    }\n\n    clearTimeout(this.pingTimer);\n    this.pingTimer = setTimeout(() => {\n      verifyToken(this.state.authToken).then(\n        () => this.queueAuthPing(),\n        () => this.state.authToken && this.setState(logoutAction(gettext('Your login has expired please log in again')))\n      );\n    }, 30 * 1000 /* 30s */)\n  }\n\n  setupLoggedIn() {\n    this.handleLoadApps();\n    this.queueAuthPing();\n  }\n\n  async handleLogin(credentials) {\n    this.setState({authStatus: 'pending'});\n    this.setState(await performLoginAction(credentials), () => {\n      this.setupLoggedIn();\n    });\n  }\n\n  async handleLoadApps() {\n    if (this.state.authToken) {\n      this.setState(await loadAppsAction(this.state.authToken));\n    }\n  }\n\n  handleLogout() {\n    this.setState(logoutAction());\n  }\n\n  async handleAppChange({id, name}) {\n    // TODO: Loading/Error state etc.\n    this.setState(await updateAppAction(this.state.authToken, id, {name}));\n  }\n\n  render() {\n    return <App {...this.state} onAppChange={this.handleAppChange} onLogin={this.handleLogin} onLogout={this.handleLogout} />;\n  }\n}\n\nclass App extends Component {\n  renderLogin() {\n    const message = this.props.authStatus === 'error' ? gettext('Unable to log in with that email & password') : null;\n    return (\n      <div className=\"columns\">\n        <div className=\"column is-half\">\n          <LoginForm status={this.props.authStatus} message={message} onSubmit={this.props.onLogin} />\n        </div>\n      </div>\n    );\n  }\n\n  renderAppDirectory() {\n    const apps = Object.values(this.props.apps).map(app => <AppInfo key={app.id} {...app} onChange={this.props.onAppChange} />);\n    return (\n      <AppDirectory>{apps}</AppDirectory>\n    );\n  }\n\n  render() {\n    const content = this.props.authToken ? this.renderAppDirectory() : this.renderLogin();\n    let loggedInNav = null;\n    if (this.props.authToken) {\n      loggedInNav = (\n        <div className=\"navbar-end\">\n          <div className=\"navbar-item\">\n            <p className=\"control\">\n              <button className=\"button is-primary is-inverted\" onClick={this.props.onLogout}>Logout</button>\n            </p>\n          </div>\n        </div>\n      );\n    }\n    return (\n      <div>\n        <nav className=\"navbar is-primary\">\n          <div className=\"navbar-brand\">\n            <div className=\"navbar-item\">Admin</div>\n          </div>\n          {loggedInNav}\n        </nav>\n        <div className=\"section\">\n          <div className=\"container\">{content}</div>\n        </div>\n      </div>\n    );\n  }\n}"]}