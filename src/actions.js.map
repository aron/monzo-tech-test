{"version":3,"sources":["../../src/actions.jsx"],"names":[],"mappings":"AAAA,SAAQ,QAAR,EAAkB,UAAlB,EAA8B,OAA9B,QAA4C,YAA5C;AACA,SAAQ,eAAR,QAA8B,YAA9B;AACA,SAAQ,KAAR,EAAe,OAAf,EAAwB,SAAxB,EAAmC,SAAnC,QAAmD,aAAnD,C,CAEA;;AACA,OAAO,eAAe,kBAAf,CAAkC;AAAC,EAAA,KAAD;AAAQ,EAAA,QAAR;AAAkB,EAAA;AAAlB,CAAlC,EAA6D;AAClE,MAAI;AACF,UAAM,KAAK,GAAG,MAAM,KAAK,CAAC,KAAD,EAAQ,QAAR,EAAkB,MAAlB,CAAzB;AACA,IAAA,QAAQ,CAAC,KAAD,CAAR;AACA,WAAO;AACL,MAAA,SAAS,EAAE,KADN;AAEL,MAAA,UAAU,EAAE;AAFP,KAAP;AAID,GAPD,CAOE,OAAO,GAAP,EAAY;AACZ,QAAI,GAAG,YAAY,SAAnB,EAA8B;AAC5B,aAAO;AAAC,QAAA,SAAS,EAAE,IAAZ;AAAkB,QAAA,UAAU,EAAE;AAA9B,OAAP;AACD,KAFD,MAEO;AACL,aAAO,OAAO,CAAC,MAAR,CAAe,GAAf,CAAP;AACD;AACF;AACF;AAED,OAAO,eAAe,cAAf,CAA8B,KAA9B,EAAqC;AAC1C,MAAI;AACF,UAAM,IAAI,GAAG,MAAM,OAAO,CAAC,KAAD,CAA1B;AACA,WAAO;AACL,MAAA,UAAU,EAAE,MADP;AAEL,MAAA,IAAI,EAAE,IAAI,CAAC,MAAL,CAAY,CAAC,GAAD,EAAM,GAAN,KAAc;AAC9B,QAAA,GAAG,CAAC,GAAG,CAAC,EAAL,CAAH,GAAc,GAAd;AACA,eAAO,GAAP;AACD,OAHK,EAGH,EAHG;AAFD,KAAP;AAOD,GATD,CASE,OAAO,GAAP,EAAY;AACZ,QAAI,GAAG,YAAY,SAAnB,EAA8B;AAC5B,UAAI,GAAG,CAAC,cAAR,EAAwB;AACtB,eAAO,YAAY,CAAC,OAAO,CAAC,+CAAD,CAAR,CAAnB;AACD,OAFD,MAEO;AACL,eAAO;AAAC,UAAA,UAAU,EAAE;AAAb,SAAP;AACD;AACF,KAND,MAMO;AACL,aAAO,OAAO,CAAC,MAAR,CAAe,GAAf,CAAP;AACD;AACF;AACF;AAED,OAAO,eAAe,eAAf,CAA+B,KAA/B,EAAsC,KAAtC,EAA6C,KAA7C,EAAoD;AACzD,MAAI;AACF,UAAM,GAAG,GAAG,MAAM,SAAS,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,CAA3B;AACA,WAAO,KAAK,KAAK;AACf;AACA,MAAA,IAAI,EAAE,MAAM,CAAC,MAAP,CAAc,EAAd,EAAkB,KAAK,CAAC,IAAxB,EAA8B;AAAC,SAAC,GAAG,CAAC,EAAL,GAAU;AAAX,OAA9B;AAFS,KAAL,CAAZ;AAID,GAND,CAME,OAAO,GAAP,EAAY;AACZ,QAAI,GAAG,YAAY,SAAnB,EAA8B;AAC5B,UAAI,GAAG,CAAC,cAAR,EAAwB;AACtB,eAAO,YAAY,CAAC,OAAO,CAAC,+CAAD,CAAR,CAAnB;AACD,OAFD,MAEO;AACL,eAAO,EAAP,CADK,CACM;AACZ;AACF,KAND,MAMO;AACL,aAAO,OAAO,CAAC,MAAR,CAAe,GAAf,CAAP;AACD;AACF;AACF;AAED,OAAO,SAAS,YAAT,CAAsB,OAAtB,EAA+B;AACpC,MAAI,OAAJ,EAAa;AACX,IAAA,KAAK,CAAC,OAAD,CAAL;AACD;;AACD,EAAA,UAAU;AACV,SAAO,eAAe,EAAtB;AACD","file":"actions.js","sourcesContent":["import {setToken, clearToken, gettext} from './utils.js';\nimport {initialAppState} from './store.js';\nimport {login, getApps, updateApp, HTTPError} from './client.js';\n\n// Performs the login request and returns new state.\nexport async function performLoginAction({email, password, expiry}) {\n  try {\n    const token = await login(email, password, expiry);\n    setToken(token);\n    return {\n      authToken: token,\n      authStatus: 'done',\n    };\n  } catch (err) {\n    if (err instanceof HTTPError) {\n      return {authToken: null, authStatus: 'error'};\n    } else {\n      return Promise.reject(err);\n    }\n  }\n}\n\nexport async function loadAppsAction(token) {\n  try {\n    const apps = await getApps(token);\n    return {\n      appsStatus: 'done',\n      apps: apps.reduce((obj, app) => {\n        obj[app.id] = app;\n        return obj;\n      }, {})\n    };\n  } catch (err) {\n    if (err instanceof HTTPError) {\n      if (err.isUnauthorized) {\n        return logoutAction(gettext('You have been logged out, please log in again'));\n      } else {\n        return {appsStatus: 'error'};\n      }\n    } else {\n      return Promise.reject(err);\n    }\n  }\n}\n\nexport async function updateAppAction(token, appId, props) {\n  try {\n    const app = await updateApp(token, appId, props);\n    return state => ({\n      // TODO: Enable babel spread transform...\n      apps: Object.assign({}, state.apps, {[app.id]: app}),\n    });\n  } catch (err) {\n    if (err instanceof HTTPError) {\n      if (err.isUnauthorized) {\n        return logoutAction(gettext('You have been logged out, please log in again'));\n      } else {\n        return {}; // TODO: Handle this better.\n      }\n    } else {\n      return Promise.reject(err);\n    }\n  }\n}\n\nexport function logoutAction(message) {\n  if (message) {\n    alert(message);\n  }\n  clearToken();\n  return initialAppState();\n}"]}